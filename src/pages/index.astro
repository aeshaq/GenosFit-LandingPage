---
import BaseLayout from "../layouts/BaseLayout.astro";

const supabaseUrl = import.meta.env.PUBLIC_SUPABASE_URL;
const supabaseAnonKey = import.meta.env.PUBLIC_SUPABASE_ANON_KEY;
---
<BaseLayout title="GenosFit | Train by your biology" description="GenosFit builds adaptive training plans based on your biology, recovery, and goals.">
  <header class="container nav">
    <div class="logo">GenosFit</div>
    <nav>
      <a href="#features">Features</a>
      <span aria-hidden="true"> · </span>
      <a href="#how">How it works</a>
      <span aria-hidden="true"> · </span>
      <a href="#faq">FAQ</a>
    </nav>
  </header>

  <main>
    <section class="container hero fade-in">
      <div>
        <span class="pill">Built for gyms</span>
        <h1>Turn workouts into community and retention.</h1>
        <p>
          GenosFit helps gyms build a real member community with tracked workouts, friendly competition, and features
          that keep members coming back. Join the waitlist for early access.
        </p>
        <div class="cta-group">
          <a class="button primary" href="#waitlist">Join the waitlist</a>
        </div>
      <div class="badge-row">
        <span class="pill">Gym-first product</span>
        <span class="pill">Member feed</span>
        <span class="pill">Live leaderboards</span>
      </div>
    </div>
    <div class="card stagger">
      <h3>Community drives retention</h3>
      <p>Social connection is the biggest predictor of who keeps showing up.</p>
      <div class="card-grid">
        <div class="card">
          <h4>Belonging beats willpower</h4>
          <p>
            Members stick when they feel seen, supported, and connected to others.
          </p>
        </div>
        <div class="card">
          <h4>Shared workouts create momentum</h4>
          <p>
            Shared wins and visible progress make members show up more often.
          </p>
        </div>
        <div class="card">
          <h4>Leaderboards spark competition</h4>
          <p>
            Friendly rankings turn progress into momentum and keep members engaged.
          </p>
        </div>
      </div>
    </div>
    </section>

    <section id="features" class="section container">
      <h2>Everything a gym needs to keep members moving</h2>
      <p>
        A gym-centric MVP with tracking, social proof, and leaderboards built in.
      </p>
      <div class="card-grid">
        <div class="card">
          <h3>Workout tracker</h3>
          <p>Memebers can log workouts, see insights.</p>
        </div>
        <div class="card">
          <h3>Gym leaderboards</h3>
          <p>Track lifts and see how you stack up against others in your gym.</p>
        </div>
        <div class="card">
          <h3>Member feed</h3>
          <p>Workouts post directly to the gym feed for motivation.</p>
        </div>
        <div class="card">
          <h3>Gym admin tools</h3>
          <p>Owners manage gyms, members, and engagement in one place.</p>
        </div>
      </div>
    </section>

    <section id="demo" class="section container">
      <h2>What ships in the MVP</h2>
      <p>Focus on the fundamentals that drive retention and community.</p>
      <div class="card-grid">
        <div class="card">
          <h3>Workout tracking</h3>
          <ul class="mvp-list">
            <li>Exercises, sets, reps, and timers</li>
            <li>Save templates for fast starts</li>
          </ul>
        </div>
        <div class="card">
          <h3>Gym community</h3>
          <ul class="mvp-list">
            <li>Member workout feed</li>
            <li>Auto-updating leaderboards</li>
          </ul>
        </div>
        <div class="card">
          <h3>Profiles & admin</h3>
          <ul class="mvp-list">
            <li>Member profiles with bio + avatar</li>
            <li>Gym owner admin access</li>
          </ul>
        </div>
      </div>
    </section>

    <section class="section container">
      <h2>Community keeps members engaged</h2>
      <p>Evidence shows community and motivation are major drivers of gym adherence.</p>
      <div class="research-grid">
        <div class="research-card">
          <p class="highlight">
            Boutique club members reported stronger social support and intrinsic motivation than fitness-only or
            multipurpose members.
          </p>
          <p class="source">
            Source:
            <a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC10244985/" target="_blank" rel="noreferrer">
              Differences in motivation and social support across fitness club business models (2023)
            </a>
          </p>
        </div>
        <div class="research-card">
          <p class="highlight">
            One-year follow-up of novice exercisers found attendance was most associated with enjoyment, self-efficacy,
            and social support.
          </p>
          <p class="source">
            Source:
            <a
              href="https://www.frontiersin.org/journals/psychology/articles/10.3389/fpsyg.2021.638928/full"
              target="_blank"
              rel="noreferrer"
            >
              What Makes Individuals Stick to Their Exercise Regime? (2021)
            </a>
          </p>
        </div>
      </div>
    </section>

    <section id="how" class="section container">
      <h2>How it works</h2>
      <p>Three steps to launch for your gym.</p>
      <div class="steps">
        <div class="step">
          <h4>1. Set up your gym</h4>
          <p>Create your gym, invite staff, and customize the space.</p>
        </div>
        <div class="step">
          <h4>2. Members join</h4>
          <p>Members track workouts and post to the gym feed.</p>
        </div>
        <div class="step">
          <h4>3. Compete</h4>
          <p>Leaderboards update automatically from workouts.</p>
        </div>
      </div>
    </section>

    <section class="section container">
      <h2>Pilot gyms</h2>
      <p>We are onboarding a small group of gyms to shape the MVP.</p>
      <div class="card-grid">
        <div class="card">
          <h3>Hands-on setup</h3>
          <p>We help configure your gym, staff access, and member onboarding.</p>
        </div>
        <div class="card">
          <h3>Founder support</h3>
          <p>Direct feedback loop with the product team to shape features.</p>
        </div>
        <div class="card">
          <h3>Launch pricing</h3>
          <p>Early gyms lock in discounted rates and priority access.</p>
        </div>
      </div>
    </section>

    <section id="waitlist" class="section container">
      <div class="waitlist">
        <div>
          <h2>Join the GenosFit waitlist</h2>
          <p>Get first access, launch pricing, and our training insights newsletter.</p>
        </div>
        <form
          id="waitlist-form"
          data-supabase-url={supabaseUrl}
          data-supabase-anon-key={supabaseAnonKey}
        >
          <input type="email" name="email" placeholder="you@email.com" required />
          <input type="hidden" name="source" value="landing" />
          <input type="hidden" name="referrer" />
          <input type="hidden" name="utm_campaign" />
          <input type="hidden" name="utm_source" />
          <input type="hidden" name="utm_medium" />
          <button class="button primary" type="submit">Get early access</button>
        </form>
        <div id="waitlist-status" aria-live="polite"></div>
      </div>
    </section>

    <section id="faq" class="section container">
      <h2>FAQ</h2>
      <div class="faq">
        <details>
          <summary>Who is GenosFit for?</summary>
          <p>Gyms that want to build a community for their members and increase retention.</p>
        </details>
        <details>
          <summary>How do gyms get started?</summary>
          <p>Create a gym profile, invite staff, and share the member signup link.</p>
        </details>
        <details>
          <summary>What does the MVP include?</summary>
          <p>Workout logging, saved templates, a gym feed, and automated leaderboards.</p>
        </details>
      </div>
    </section>
  </main>

  <footer class="container">
    <div>GenosFit © 2026</div>
    <div>
      <a href="/privacy">Privacy</a> · <a href="/terms">Terms</a>
    </div>
  </footer>

  <script is:inline>
    window.addEventListener("DOMContentLoaded", () => {
      const form = document.getElementById("waitlist-form");
      const statusEl = document.getElementById("waitlist-status");
      if (!form || !statusEl) return;

      const supabaseUrl = form.dataset.supabaseUrl || "";
      const supabaseAnonKey = form.dataset.supabaseAnonKey || "";
      const params = new URLSearchParams(window.location.search);
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

      const setHidden = (name, value) => {
        const input = form.querySelector(`input[name="${name}"]`);
        if (input && value) input.value = value;
      };

      setHidden("referrer", document.referrer || "direct");
      setHidden("utm_campaign", params.get("utm_campaign"));
      setHidden("utm_source", params.get("utm_source"));
      setHidden("utm_medium", params.get("utm_medium"));

      form.addEventListener("submit", async (event) => {
        event.preventDefault();
        statusEl.textContent = "Submitting...";

        const formData = new FormData(form);
        try {
          const payload = {
            email: String(formData.get("email") || "").trim().toLowerCase(),
            source: String(formData.get("source") || "landing"),
            referrer: String(formData.get("referrer") || ""),
            utm_campaign: String(formData.get("utm_campaign") || ""),
            utm_source: String(formData.get("utm_source") || ""),
            utm_medium: String(formData.get("utm_medium") || "")
          };

          if (!supabaseUrl || !supabaseAnonKey) throw new Error("missing_keys");
          if (!emailRegex.test(payload.email)) throw new Error("invalid_email");

          const res = await fetch(`${supabaseUrl}/rest/v1/waitlist`, {
            method: "POST",
            headers: {
              apikey: supabaseAnonKey,
              Authorization: `Bearer ${supabaseAnonKey}`,
              "Content-Type": "application/json",
              Prefer: "return=minimal"
            },
            body: JSON.stringify(payload)
          });

          const responseText = await res.text();
          if (!res.ok && res.status !== 409) throw new Error(responseText || "insert_failed");
          statusEl.textContent = "You're on the list. Welcome to GenosFit.";
          form.reset();
        } catch (err) {
          statusEl.textContent = "Something went wrong. Try again in a moment.";
        }
      });
    });
  </script>
</BaseLayout>
